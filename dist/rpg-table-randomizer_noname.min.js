(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.rpg_table_randomizer = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var randomizer=require("./randomizer.js"),random_table=require("./random_table.js"),table_normalizer=require("./table_normalizer.js"),random_name=require("./random_name.js")(randomizer),r_helpers=require("./r_helpers.js"),npc_gen=require("./npc.js")(randomizer);module.exports={randomizer:randomizer,RandomTable:random_table,TableNormalizer:table_normalizer,random_name:random_name,r_helpers:r_helpers,npc_generator:npc_gen};
},{"./npc.js":2,"./r_helpers.js":3,"./random_name.js":4,"./random_table.js":5,"./randomizer.js":6,"./table_normalizer.js":7}],2:[function(require,module,exports){
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};module.exports=function(e){var t={};t.Base=function(){},t.Base.prototype.id=0,t.Base.prototype.schema="",t.Base.prototype.fields=[],t.Base.prototype.helpers={},t.Base.prototype.initialize=function(){var t=this,o=r[this.schema].fields,n=Object.keys(this.fields);n.forEach(function(r){var n=o.find(function(e){return e.key===r});if(n){if(n.default)return void(t.fields[r]=n.default);if(n.source&&""!==n.source){var i=void 0;if("function"===n.type){var s=new Function(n.source);i=s.call(t)}else i=n.source;if("array"===n.type)for(var a=n.count?n.count:1,f=0;f<a;f++)t.fields[r].push(e.convertToken(i));else t.fields[r]=e.convertToken(i)}}})},t.Base.prototype.set=function(e){var t=this;if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var r=Object.keys(e);r.forEach(function(r){t.fields[r]&&(t.fields[r]=e[r])})}};var r={},o=function(e){if(!e.key||"base"===e.key||!Array.isArray(e.fields))return null;r[e.key]=e;var o=t[e.key]=function(){};if(o.prototype=new t.Base,o.prototype.constructor=o,o.prototype.schema=e.key,o.prototype.fields=[],o.prototype.helpers={},e.fields.forEach(function(e){var t=null;switch(e.type){case"string":case"text":t="";break;case"array":t=[];break;case"number":case"modifier":t=0;break;case void 0:}o.prototype.fields[e.key]=t}),e.helpers&&"object"===_typeof(e.helpers)){var n=Object.keys(e.helpers);n.forEach(function(t){o.prototype.helpers[t]=new(Function.prototype.bind.apply(Function,[null].concat(_toConsumableArray(e.helpers[t]))))})}};return{NPC:t,registerSchema:o}};
},{}],3:[function(require,module,exports){
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},isEmpty=function(t){return null===t||void 0===t||(Array.isArray(t)||isString(t)?0===t.length:0===Object.keys(t).length)},isString=function(t){return"[object String]"===toString.call(t)},isObject=function(t){var i="undefined"==typeof t?"undefined":_typeof(t);return"function"===i||"object"===i&&!!t},isUndefined=function(t){return void 0===t},capitalize=function(t){return isEmpty(t)?t:t.charAt(0).toUpperCase()+t.slice(1)};module.exports={isEmpty:isEmpty,isString:isString,isObject:isObject,isUndefined:isUndefined,capitalize:capitalize};
},{}],4:[function(require,module,exports){
"use strict";var r_helpers=require("./r_helpers.js");module.exports=function(e,n){if("undefined"==typeof n);var r=function(e,n,r){var a={male:[],female:[]};"undefined"==typeof r&&(r=!1),"undefined"==typeof e&&(e=10),"undefined"!=typeof n&&""!==n||(n="random");for(var i=1;i<=e;i++){var s=i<=Math.ceil(e/2)?"male":"female";r&&"holmesian"!==n&&"demonic"!==n?a[s].push(o(n,s,!0)):a[s].push(t(n,s))}return a},t=function(r,t,a){var o="";switch("undefined"!=typeof r&&""!==r&&"random"!==r||(r=e.rollRandom(Object.keys(n.options))),"undefined"!=typeof t&&"random"!==t||(t=e.rollRandom(["male","female"])),"undefined"!=typeof a&&"first"===a||(a=""),r){case"holmesian":o=s();break;case"demonic":o=f();break;case"cornish":case"flemish":case"dutch":case"turkish":default:o=e.rollRandom(n[r][t]),"first"===a||"undefined"==typeof n[r].surname||r_helpers.isEmpty(n[r].surname)||(o+=" "+e.rollRandom(n[r].surname)),o=e.findToken(o).trim()}return i(o)},a=function(r){var t="";if("undefined"!=typeof r&&""!==r&&"random"!==r||(r=e.rollRandom(Object.keys(n.options))),"undefined"==typeof n[r].surname||r_helpers.isEmpty(n[r].surname))return"";switch(r){case"holmesian":t=s();break;case"cornish":case"flemish":case"dutch":case"turkish":default:t=e.rollRandom(n[r].surname),t=e.findToken(t)}return i(t)},o=function(r,t,a){if("undefined"!=typeof r&&""!==r&&"random"!==r||(r=e.rollRandom(Object.keys(n.options))),"undefined"==typeof a&&(a=""),!n[r])return"";("undefined"==typeof t||"male"!==t&&"female"!==t)&&(t=e.rollRandom(["male","female"]));var o=r+"_"+t,s="",f="";if(l.memory||(l=new m({order:3})),!l.memory[o]){var u=[];""===t?(u=n[r].male,u=u.concat(n[r].female)):u=n[r][t],u.forEach(function(e){l.learn(o,e)})}return"first"===a||r_helpers.isEmpty(n[r].surname)||!function(){var e=r+"_last";if(!l.memory[e]){var t=n[r].surname;t.forEach(function(n){l.learn(e,n)})}s=l.generate(e)}(),f=l.generate(o)+" "+s,i(f.trim())},i=function(e){var n=["of","the","from","de","le","la"],r=e.split(" "),t=r.map(function(e){return n.indexOf(e)>=0?e:""+r_helpers.capitalize(e)});return t.join(" ")},s=function(){for(var r="",t=e.getWeightedRandom(n.holmesian_scount.values,n.holmesian_scount.weights),a=1;a<=t;a++)r+=e.rollRandom(n.holmesian_syllables),a<t&&(r+=e.getWeightedRandom([""," ","-"],[3,2,2]));return r=r.toLowerCase()+" "+e.rollRandom(n.holmesian_title),r=e.findToken(r),r=r.replace(/[\s\-]([a-z]{1})/g,function(e){return e.toUpperCase()})},f=function(){for(var r="",t=e.getWeightedRandom([["first","last"],["first","inner","last"],["first","inner","inner","last"],["first","inner","inner","inner","last"]],[55,35,7,3]),a=0;a<t.length;a++)r+=e.rollRandom(n.demonic[t[a]]);return r},u=function(e,r,t){return"undefined"!=typeof e&&""!==t&&("undefined"!=typeof t&&""!==t||(t=e),!!(r.male||r.female||r.surname)&&(n[e]=r,n.options[e]=t,!0))};e.registerTokenType("name",function(e,n,r){var t="";return"undefined"!=typeof e[1]&&""!==e[1]&&"random"!==e[1]||(e[1]=""),"undefined"!=typeof e[3]&&"first"===e[3]||(e[3]=""),"undefined"!=typeof e[2]&&""!==e[2]||(e[2]="random"),t=o(e[1],e[2],e[3])});var m=function(e){"undefined"==typeof e&&(e={}),this.memory={},this.separator=e.separator?e.separator:"",this.order=e.order?e.order:2,this.learn=function(e,n){var r=this.memory[e]?this.memory[e]:{};this.breakText(n,function(e,n){return r[e]||(r[e]=[]),r[e].push(n),r}),this.memory[e]=r},this.generate=function(e,n){return n||(n=this.genInitial()),this.cur_key=e,n.concat(this.step(n,[])).join(this.separator)},this.step=function(e,n){var r=this.memory[this.cur_key][e]||[""],t=this.getRandomValue(r);if(!t)return n;n.push(t);var a=e.slice(1);return a.push(t),this.step(a,n)},this.breakText=function(e,n){var r=e.split(this.separator),t=this.genInitial();r.forEach(function(e){e=e.toLowerCase(),n(t,e),t.shift(),t.push(e)}),n(t,"")},this.genInitial=function(){for(var e=[],n=0;n<this.order;e.push(""),n++);return e},this.getRandomValue=function(e){return e[Math.floor(Math.random()*e.length)]}},l=new m({order:3});return{generateList:r,selectName:t,selectSurname:a,createName:o,capitalizeName:i,holmesname:s,demonname:f,registerNameType:u,namedata:n}};
},{"./r_helpers.js":3}],5:[function(require,module,exports){
"use strict";var r_helpers=require("./r_helpers.js"),RandomTable=function(e){this.id=0,this.key="",this.title="",this.author="",this.description="",this.source="",this.tags=[],this.sequence="",this.tables={},this.macro=[],this.dependencies=null,this.result=[];var t=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(!r_helpers.isEmpty(this.table)){var i=this.tables;i.default=this.table,this.tables=i,delete this.table}""===this.key&&(this.key=this.id)};this.validate=function(e){var t={fields:[],general:""};return""===e.title&&(t.fields.push({field:"title",message:"Title cannot be blank"}),t.general+="Title cannot be blank. "),r_helpers.isEmpty(e.tables)&&r_helpers.isEmpty(e.macro)&&(t.fields.push({field:"tables",message:"Both Tables and Macro cannot be empty"}),t.general+="Both Tables and Macro cannot be empty. "),!(!r_helpers.isEmpty(t.fields)||!r_helpers.isEmpty(t.general))||t},this.niceString=function(e){"undefined"==typeof e&&(e=!1);var t=this.result;if(r_helpers.isString(t)||!Array.isArray(t)||0===t.length)return"";if(e)return t[0].result;var i="",r=this.print?this.print:{};return t.forEach(function(e){r[e.table]?(r[e.table].hide_table&&0!==r[e.table].hide_table||(i+=r_helpers.capitalize(e.table)+": "),r[e.table].hide_result&&0!==r[e.table].hide_result||(i+=r_helpers.capitalize(e.result)+"\n"),r[e.table].hide_desc&&0!==r[e.table].hide_desc||""!==e.desc&&(i+=e.desc+"\n")):(i+="default"===e.table?r_helpers.capitalize(e.result)+"\n":r_helpers.capitalize(e.table)+": "+r_helpers.capitalize(e.result)+"\n",""!==e.desc&&(i+=e.desc+"\n"))}),i=i.trim()},this.outputObject=function(e){"undefined"==typeof e&&(e=!1);var t=JSON.parse(JSON.stringify(this)),i=Object.keys(t);return i.forEach(function(i){!e&&r_helpers.isEmpty(t[i])&&delete t[i]}),t.result&&e?t.result=[]:t.result&&delete t.result,delete t.id,t},this.outputCode=function(e,t){"undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1);var i=this.outputObject(e);return t?JSON.stringify(i):JSON.stringify(i,null,2)},this.findObject=function(e,t){"undefined"!=typeof t&&""!==t||(t="default");var i=this.tables[t];if(i[e])return i[e];if(Array.isArray(i)){var r=i.find(function(t){return t.label===e});return"undefined"!=typeof r?r:{}}return{}},this.findResultElem=function(e){"undefined"!=typeof e&&""!==e||(e="default");var t=this.result.find(function(t){return t.table===e});return"undefined"!=typeof t?t:{}},this.findDependencies=function(){var e=this;if(null!==this.dependencies)return this.dependencies;var t=[],i=new RegExp("({{2}.+?}{2})","g"),r=Object.keys(this.tables);return r.forEach(function(r){var s=e.tables[r];s.forEach(function(e){if(e.label){var r=e.label.match(i);null!==r&&r.forEach(function(e){var i=e.replace("{{","").replace("}}","").split(":");i.length>1&&"table"===i[0]&&"this"!==i[1]&&t.push(i[1])})}})}),t=t.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]),this.dependencies=t,t},t.call(this,e)};module.exports=RandomTable;
},{"./r_helpers.js":3}],6:[function(require,module,exports){
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r_helpers=require("./r_helpers.js"),Randomizer=function(){function e(e){for(var t=0,r=0;r<e.length;r++){var n=parseFloat(e[r]);isNaN(n)||(t+=n)}return t}function t(e,t,r,n){r="undefined"==typeof r?0:parseInt(r,10),e="undefined"==typeof e?6:parseInt(e,10),n="undefined"==typeof n?"+":n,t="undefined"==typeof t||0===t?1:parseInt(t,10);for(var i=0,s=1;s<=t;s++)i+=this.random(1,e);if(0===r)return i;switch(n){case"*":i*=r;break;case"-":i-=r;break;case"/":i/=r;break;case"+":default:i+=r}return Math.round(i)}var r=this;this.token_types={},this.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},this.getWeightedRandom=function(t,r){for(var n=0,i=this.random(1,e.call(this,r)),s=0;s<t.length&&(n+=r[s],!(n>=i));s++);return t[s]},this.rollRandom=function(e){var t=[],r=[];if(Array.isArray(e))e.forEach(function(e,n,i){"object"===("undefined"==typeof e?"undefined":_typeof(e))?("undefined"!=typeof e.weight?r.push(e.weight):r.push(1),t.push(e.label)):"string"==typeof e&&(r.push(1),t.push(e))});else if("object"===("undefined"==typeof e?"undefined":_typeof(e))&&null!==e){var n=Object.keys(e);n.forEach(function(n){var i=e[n];"undefined"!=typeof i.weight?r.push(i.weight):r.push(1),t.push(n)})}return this.getWeightedRandom(t,r)},this.getTableResult=function(e,t){var r=this;if(!r_helpers.isObject(e))return[{table:"Error",result:"No table found to roll on.",desc:""}];var n=[];if("undefined"==typeof t&&(t=""),!r_helpers.isEmpty(e.macro))return e.macro.forEach(function(e){var t=r.getTableByKey(e);r_helpers.isEmpty(t)||(r.getTableResult(t),n.push({table:e,result:t.niceString()}))}),e.result=n,n;var i=""===t?e.sequence:t;if("rollall"===i&&(i=Object.keys(e.tables)),""===i)if("undefined"!=typeof e.tables.default)n=this.selectFromTable(e,"default");else{var s=Object.keys(e.tables);n=this.selectFromTable(e,s[0])}else"string"==typeof i?n=this.selectFromTable(e,i):i.forEach(function(t){var i="";if(r_helpers.isString(t))return i=r.selectFromTable(e,t),void(n=n.concat(i));var s=t.table?t.table:"";if(""!==s)for(var o="number"==typeof t.times?t.times:1,l=1;l<=o;l++)i=r.selectFromTable(s),n=n.concat(i)});return e.result=n,n},this.selectFromTable=function(e,t){var r=this;if(!r_helpers.isObject(e))return[{table:"Error",result:"No table found to roll on.",desc:""}];if("undefined"==typeof t)return[{table:"Error",result:"No table found to roll on.",desc:""}];var n=[],i=e.tables[t],s=this.rollRandom(i),o="",l=!0;if(r_helpers.isUndefined(i[s])){if(o=i.find(function(e){return e.label===s}),r_helpers.isUndefined(o))return n.push({table:t,result:s,desc:""}),n;l="undefined"==typeof o.print||o.print}else o=i[s],l="undefined"==typeof i[s].print||i[s].print;if(l===!0){var f=r_helpers.isString(o.description)?o.description:"",a=this.findToken(s,e.key);n.push({table:t,result:a,desc:f})}var u=o.subtable,p="";if("undefined"==typeof u)return n;if(r_helpers.isString(u))p=this.selectFromTable(e,u),n=n.concat(p);else if(Array.isArray(u))u.forEach(function(t){p=r.selectFromTable(e,t),n=n.concat(p)});else if(r_helpers.isObject(u)){var c=Object.keys(u);c.forEach(function(t){var i=r.rollRandom(u[t]),s="";r_helpers.isUndefined(u[t][i])?(p=u[t].find(function(e){return e.label===i}),r_helpers.isObject(p)&&(s=r_helpers.isString(p.description)?p.description:"")):s=r_helpers.isString(u[t][i].description)?u[t][i].description:"",i=r.findToken(i,e.key),n.push({table:t,result:i,desc:s})})}return n},this.convertToken=function(e,t){var r=e.replace("{{","").replace("}}","").split(":");return 0===r.length?e:this.token_types[r[0]]?this.token_types[r[0]](r,e,t):e},this.tokenRegExp=new RegExp("({{2}.+?}{2})","g"),this.findToken=function(e,t,r){var n=this;if(r_helpers.isEmpty(e))return"";"undefined"==typeof t&&(t="");var i=e.replace(this.tokenRegExp,function(e){return n.convertToken(e,t)});return i},this.roll=function(e){e="undefined"==typeof e?"":e.trim();var r=e.match(/^([0-9]*)d([0-9]+)(?:([\+\-\*\/])([0-9]+))*$/);return r?("undefined"==typeof r[4]&&(r[4]=0),""!==r[1]?t.call(this,parseInt(r[2],10),parseInt(r[1],10),parseInt(r[4],10),r[3]):t.call(this,parseInt(r[2],10),"1",parseInt(r[4],10),r[3])):""},this.setTableKeyLookup=function(e){this.getTableByKey=e},this.getTableByKey=function(e){return null},this.registerTokenType=function(e,t){this.token_types[e]=t},this.registerTokenType("roll",function(e,t,n){return r.roll(e[1])}),this.registerTokenType("table",function(e,t,n){var i="";if("undefined"==typeof e[1])return t;var s=1;if(e[1].indexOf("*")!==-1){var o=e[1].split("*");e[1]=o[0],s=o[1]}var l=null;if(l="this"===e[1]?r.getTableByKey(n):r.getTableByKey(e[1]),null===l||"object"!==("undefined"==typeof l?"undefined":_typeof(l)))return t;if("undefined"!=typeof e[2]&&e[2].indexOf("*")!==-1){var f=e[2].split("*");e[2]=f[0],s=f[1]}for(var a="undefined"==typeof e[2]?"":e[2],u=1;u<=s;u++)r.getTableResult(l,a),i+=l.niceString()+", ";return i=i.trim(),i=i.replace(/,$/,"")})};module.exports=new Randomizer;
},{"./r_helpers.js":3}],7:[function(require,module,exports){
"use strict";var r_helpers=require("./r_helpers"),TableNormalizer=function(t){this.orig_data="undefined"!=typeof t?t:"",this.normalized_data={},this.data_type="",this.setData=function(t){this.orig_data=t},this.checkType=function(){var t=this.orig_data;if(r_helpers.isEmpty(t))this.data_type="";else if(r_helpers.isString(t)){try{return JSON.parse(t),this.data_type="json",this.data_type}catch(t){}if("<"===t.substring(0,1))return this.data_type="html",this.data_type;this.data_type="text"}else r_helpers.isObject(t)&&(this.data_type="object");return this.data_type},this.parseHtml=function(){var t=this.orig_data;t=t.replace(/[\n\r]+/g,""),t=t.replace(/<\/(p|tr|li|div)>|<\/?br\/?>/g,"\n").replace(/\t/g,""),t=t.replace(/<\/?[^>]+>/g,"").replace(/[\n\r]+$/g,"");var e=t.split(/[\n\r]+/g),a=0;return e.forEach(function(t,e,r){t=t.trim();var i=t.match(/^(?:(?:[0-9]+\-)?([0-9]+)(##)?(?:\.\s*|:\s*|,\s*|\t+|\s*))?(.+?)(?:##(.+))?$/);if(i){if(r[e]={label:i[3].trim()},"undefined"!=typeof i[1]){var s=1;"undefined"==typeof i[2]?(s=parseFloat(i[1])-a,s<1&&(s=1),a+=s):s=parseFloat(i[1]),s>1&&(r[e].weight=s)}else a++;"undefined"!=typeof i[4]&&(r[e].subtable=i[4].trim())}else delete r[e]}),e},this.parseText=function(){var t=this.orig_data;t=t.split(/[\n\r]+/g);var e=0;return t.forEach(function(t,a,r){t=t.trim();var i=t.match(/^(?:(?:[0-9]+\-)?([0-9]+)(##)?(?:\.\s*|:\s*|,\s*|\t+|\s*))?(.+?)(?:##(.+))?$/);if(i){var s=i[3].trim();if(s=s.replace(/^[-*]\s?/,""),r[a]={label:s},"undefined"!=typeof i[1]){var n=1;"undefined"==typeof i[2]?(n=parseFloat(i[1])-e,n<1&&(n=1),e+=n):n=parseFloat(i[1]),n>1&&(r[a].weight=n)}else e++;"undefined"!=typeof i[4]&&(r[a].subtable=i[4].trim())}else delete r[a]}),t},this.parseMarkdown=function(){},this.normalizeData=function(){var t=this.checkType();if(""===t)return!1;var e=null;switch(t){case"html":this.normalized_data=this.parseHtml();break;case"text":this.normalized_data=this.parseText();break;case"json":e=JSON.parse(this.orig_data),this.normalized_data=e}return this.normalized_data}};module.exports=TableNormalizer;
},{"./r_helpers":3}]},{},[1])(1)
});


//# sourceMappingURL=dist/rpg-table-randomizer_noname.js.map