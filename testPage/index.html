<html>
    <head>

    </head>
    <body>

        <script type="module">
            import Randomizer from '../src/randomizer.js';
            import RandomTable from '../src/random_table.js';
            import normalizeData from '../src/table_normalizer.js';
            import RandomName from '../src/random_name.js';
            import { NPCSchema } from '../src/npc_schema.js';
            import npcGenerator from '../src/npc.js';

            const testTables = {};

            await fetch('../sample/names.json')
                .then(response => response.json())
                .then((obj) => {
                    RandomName.setNameData(obj);
                });

            const randomizer = new Randomizer({});
            RandomName.setRandomizer(randomizer);
            console.log(randomizer.roll('2d6+1'));


            randomizer.setTableKeyLookup(function(key) {
                return testTables[key] || null;
            });

            randomizer.registerTokenType('name', RandomName.nameTokenCallback);

            await fetch('../sample/general.json')
                .then(response => response.json())
                .then((array) => {
                    array.forEach((obj) => {
                        const table = new RandomTable(obj);
                        testTables[table.key] = table;
                    });



                });

            console.log(RandomName.generateList(4, 'flemish'));
            console.log(RandomName.createName('french', 'female'));
            console.log(randomizer.getTableResultByKey('ordinal'));
            console.log(randomizer.getTableResultByKey('colonial_companies'));

            const simpleSchema = new NPCSchema({
                key: 'simple',
                name: 'Simple Schema',
                fields: [
                    { type: 'string', key: 'type', starting_value: 'foo' },
                    { type: 'string', key: 'name', source: 'name:french:female' },
                    { type: 'array', key: 'colors', source: '{{ table:color }}', count: 3 }
                ]
            });

            npcGenerator.registerSchema(simpleSchema);

            console.log(
                npcGenerator.initializeNewNPC('simple', randomizer)
            );
        </script>
    </body>
</html>
