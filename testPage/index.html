<html>
    <head>

    </head>
    <body>
        <p>Demo output...</p>
        <script type="module">
            import TableRoller from '../src/TableRoller.js';
            import { rollDie, getDiceResult } from '../src/dice_roller.js';
            import RandomTable from '../src/random_table.js';
            import normalizeData from '../src/table_normalizer.js';
            import RandomNameGenerator from '../src/RandomNameGenerator.js';
            import RandomNameType from '../src/RandomNameType.js';
            import { NPCSchema } from '../src/npc_schema.js';
            import * as npcGenerator from '../src/npc.js';
            import names from '../sample/names.js';
            import generalTables from '../sample/general.js';
            import colonialTables from '../sample/colonial.js';
            import colonialMission from '../sample/colonial_mission.js';
            import npcTables from '../sample/npc_tables.js';
            import { simple as simpleSchemaData } from '../sample/schemas.js';


            console.log(JSON.stringify(
                [
                    getDiceResult('d6'),
                    getDiceResult('2d6+1')
                ]
            ));

            const printToScreen = function(any) {
                const p = document.createElement('p');
                p.innerText = JSON.stringify(any);
                document.body.appendChild(p);
            }

            const tableObjs = generalTables.concat(colonialTables, colonialMission, npcTables);

            const testTables = {};
            tableObjs.forEach((obj) => {
                const table = new RandomTable(obj);
                testTables[table.key] = table;
                // printToScreen(`Loaded table ${table}`);
            });

            const tableRoller = new TableRoller({});

            // Format name data
            const nameTypes = [];
            names.forEach((data) => {
                nameTypes.push(new RandomNameType(data));
            });
            // Create a default name generator.
            const defaultNameGenerator = new RandomNameGenerator({ namedata: nameTypes });
            // Assign it to the name token of the table roller.
            tableRoller.registerTokenType('name', defaultNameGenerator.nameTokenCallback.bind(defaultNameGenerator));

            tableRoller.setTableKeyLookup(function(key) {
                return testTables[key] || null;
            });

            printToScreen('Dice roller...');
            printToScreen(rollDie('2d6+1'));
            printToScreen(getDiceResult('4d6+1'));
            printToScreen('Name generator...');
            printToScreen(defaultNameGenerator.generateList(4, 'flemish'));
            printToScreen(defaultNameGenerator.createName('french', 'female'));
            printToScreen(defaultNameGenerator.createName('french', 'mixed'));

            printToScreen('NPC generator...');
            const simpleSchema = new NPCSchema(simpleSchemaData);

            printToScreen(JSON.stringify(simpleSchema));
            npcGenerator.registerSchema(simpleSchema);
            const npc = npcGenerator.initializeNewNPC('simple', tableRoller);
            printToScreen(
                npc
            );
            console.log(npc);

            printToScreen('TableRoller...');
            const ordResult = tableRoller.getTableResultSetByKey('ordinal');
            printToScreen(ordResult);
            printToScreen(ordResult.niceString());
            const companyResult = tableRoller.getTableResultSetByKey('colonial_companies');
            printToScreen(companyResult);
            printToScreen(companyResult.niceString());
            const missionResult = tableRoller.getTableResultSetByKey('mission_generator');
            printToScreen(missionResult);
            printToScreen(missionResult.niceString());

            const swampEncounter = tableRoller.getTableByKey('colonial_encounters_swamp');
            printToScreen(swampEncounter);
            const swampEncounterResult = tableRoller.getTableResultSetByKey('colonial_encounters_swamp');
            printToScreen(swampEncounterResult);
            printToScreen(swampEncounterResult.niceString());

            printToScreen('Demon name: ' + tableRoller.getTableResultSetByKey('demon_name').niceString());

            printToScreen('Holmes name: ' + tableRoller.getTableResultSetByKey('holmes_name').niceString());


            // Example of too complicated tables used as tokens... and how niceString(true) really pares them down.
            const anotherTable = new RandomTable({
               key: 'another_table',
               title: 'Trying something complicated',
               tables: {
                   default: [
                       '{{table:mission_generator}} {{table:colonial_encounters_swamp}}'
                   ]
                }
            });
            printToScreen(tableRoller.getTableResult(anotherTable));
        </script>
    </body>
</html>
